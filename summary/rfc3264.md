> Read [original](https://tools.ietf.org/html/rfc3264) / [markdown](../markdown/rfc3264.md)

---

# An Offer/Answer Model with the Session Description Protocol (SDP)

## 1 Introduction

- もともとSDPはマルチキャストのために生まれた
  - SAP(Session Announcement Protocol)とあわせて使う
- しかしユニキャストだと、参加者の環境の要件の最小公倍数が必要
- オファーとアンサーに概念を分けることでこれに対応したい
- そのSDPをどう伝えるか = シグナリングは規定しない

## 2 Terminology

- いつもの

## 3 Definitions

- 単語の定義

## 4 Protocol Operation

- オファーを何らかの経路で送る
- それは受け取られるかもしれないし、拒否されるかもしれない
  - 拒否されるとなかったことになる
- 一度オファーを受け取ったら、その側はオファーを生成してはいけない
- 受取も拒否もされてないなら、新しいオファーを生成してはいけない
- オファーを出していながらオファーを受け取っりする状態をグレアという
  - こうならないようにするのもシグナリングプロトコルの債務
    - たとえばSIP

## 5 Generating the Initial Offer

- RFC2327では`e=`行と`p=`行が必要だったが不要にする
- `o=`行: セッションのID、バージョンなど
  - SDPとしては複数のセッションを記述できる
  - けどここでは単一のセッションのみに限定
- `s=`行: セッションのタイトル
  - 特にない場合は`-` OR 空白文字`0x20`のどちらかがおすすめ
- `t=`行: セッションの時間
  - 外部でシグナリングする場合は`0 0`
- `m=`セクション: 0個以上のメディアストリーム
  - `m=`行からはじまる
  - `a=`行: 属性を表すのに使う
- マルチキャストかユニキャストかによって、`m=`セクションの構成が変わる

## 5.1 Unicast Streams

- ストリームはそもそも双方向の土管
  - 送信専用の場合は、`a=sendonly`
  - 受信専用の場合は、`a=recvonly`
  - どっちもしない場合は、`a=inactive`
  - デフォルトの場合は、`a=sendrecv`で省略可能
- オファーに書いてあるアドレスとポートに対してRTPが送られる
  - RTCPは明示されない限り`そのポート + 1`に送られる
  - ポートが`0`の場合は、メディアが不要であるということ
- RTPならRTPのペイロードタイプが記載される
  - `a=rtpmap`
  - 複数記載することで、どれかが使えるという意味になる
  - セッションの途中で変えることもできる
  - `a=fmtp`で細かいパラメータを指定する
- `m=`行のフォーマットは優先度順
- `a=ptime`: パケットの間隔は`0`より大きい値
- ストリームは複数あることもある
  - それぞれエンコーディングが違ってもよい
  - 複数受け取ったら、全て表示する必要がある
  - 表示する出口が1つの場合、何らかの形で1つにする必要がある
  - 送信元が同じであれば、送信前に結合されている必要がある
- プリペイドのテレホンカードのアプリが典型例

## 5.2 Multicast Streams

- `recvonly`か`sendonly`なストリームが含まれる場合
- 誰かしらがそれを望んでいるということ

## 6 Generating the Answer

- オファーとアンサーは別の参加者によって作られる
  - `o=`行は異なるし無関係
- オファーの`m=`セクションとアンサーの`m=`セクションの数は同じである必要がある
- `t=`行は一致している必要がある
- なんらかの理由でオファーを拒否することもある
  - その場合は当然メディアを送ってはいけない

## 6.1 Unicast Streams

## 6.2 Multicast Streams

## 7 Offerer Processing of the Answer

## 8 Modifying the Session

## 8.1 Adding a Media Stream

## 8.2 Removing a Media Stream

## 8.3 Modifying a Media Stream

## 8.3.1 Modifying Address, Port or Transport

## 8.3.2 Changing the Set of Media Formats

## 8.3.3 Changing Media Types

## 8.3.4 Changing Attributes

## 8.4 Putting a Unicast Media Stream on Hold

## 9 Indicating Capabilities

## 10 Example Offer/Answer Exchanges

## 10.1 Basic Exchange

## 10.2 One of N Codec Selection

## 11 Security Considerations

## 12 IANA Considerations
